<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Piescraft 2D</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #87ceeb;
    overflow: hidden;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
}

#game {
    display: block;
    margin: auto;
    background: #6ab04c;
}

.controls {
    position: fixed;
    bottom: 10px;
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 10px;
}

button {
    font-size: 18px;
    padding: 14px;
    border-radius: 10px;
    border: none;
    background: #ffffffcc;
}
button:active {
    background: #ddd;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div class="controls">
    <button ontouchstart="move(-1,0)">⬅️</button>
    <button ontouchstart="move(0,-1)">⬆️</button>
    <button ontouchstart="dig()">⛏️</button>
    <button ontouchstart="move(0,1)">⬇️</button>
    <button ontouchstart="move(1,0)">➡️</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = 320;
    canvas.height = 480;
}
resize();

const TILE = 32;
const COLS = 10;
const ROWS = 15;

let score = 0;

// świat
let world = [];
for (let y = 0; y < ROWS; y++) {
    world[y] = [];
    for (let x = 0; x < COLS; x++) {
        world[y][x] = y > 5 ? (Math.random() < 0.12 ? 2 : 1) : 0;
    }
}

// pies
const player = { x: 5, y: 4 };

function move(dx, dy) {
    const nx = player.x + dx;
    const ny = player.y + dy;
    if (nx < 0 || nx >= COLS || ny < 0 || ny >= ROWS) return;
    if (world[ny][nx] === 0) {
        player.x = nx;
        player.y = ny;
    }
}

function dig() {
    const by = player.y + 1;
    if (world[by] && world[by][player.x] !== 0) {
        if (world[by][player.x] === 2) score++;
        world[by][player.x] = 0;
    }
}

function gravity() {
    const below = player.y + 1;
    if (below < ROWS && world[below][player.x] === 0) {
        player.y++;
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
            if (world[y][x] === 1) {
                ctx.fillStyle = "#8B4513";
                ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
            }
            if (world[y][x] === 2) {
                ctx.fillStyle = "#fff";
                ctx.beginPath();
                ctx.arc(x*TILE+16, y*TILE+16, 7, 0, Math.PI*2);
                ctx.fill();
            }
        }
    }

    ctx.fillStyle = "#7a3e1d";
    ctx.fillRect(player.x*TILE, player.y*TILE, TILE, TILE);

    ctx.fillStyle = "#000";
    ctx.font = "16px Arial";
    ctx.fillText("Kości: " + score, 8, 18);
}

function loop() {
    gravity();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
